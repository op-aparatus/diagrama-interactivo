<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagrama de Interacción de Especialidades Técnicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .mermaid svg {
            width: 100%;
            height: auto;
        }
        /* Agrega cursor de puntero a los nodos para indicar que son clickeables */
        .clickable {
            cursor: pointer;
        }
        .modal-enter {
            animation: fadeIn 0.3s ease-out;
        }
        .modal-leave {
            animation: fadeOut 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg w-full max-w-7xl border border-gray-200">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2 text-center">Esquema de Interacción de Especialidades Técnicas</h1>
        <p class="text-gray-600 mb-8 text-center max-w-3xl mx-auto">Este diagrama de flujo ilustra las dependencias y el orden de trabajo. <b>Haz clic en cualquier nodo para ver más detalles.</b></p>
        
        <div class="flex justify-center">
            <div class="mermaid w-full">
                graph TD
                    classDef estudios fill:#e0f2fe,stroke:#0284c7,stroke-width:2px,color:#0c4a6e;
                    classDef rector fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#14532d;
                    classDef infraestructura fill:#ffedd5,stroke:#f97316,stroke-width:2px,color:#7c2d12;
                    classDef soporte fill:#f3e8ff,stroke:#9333ea,stroke-width:2px,color:#581c87;
                    classDef gestion fill:#f1f5f9,stroke:#64748b,stroke-width:2px,color:#1e293b;
                    classDef ambiental fill:#ccfbf1,stroke:#0d9488,stroke-width:2px,color:#0f766e;

                    subgraph "Fase 1: Estudios de Base (Entradas Fundamentales)"
                        A("Topografía")
                        H("Geología y Geotecnia<br/>- Fallamiento<br/>- Suelos e Infiltración<br/>- Banco de Materiales")
                        J("Estudios Hidrológicos e Hidrogeológicos")
                    end

                    subgraph "Fase 2: Diseño Rector y de Infraestructura (Desarrollo Concurrente)"
                        B("Diseño Urbanístico y Arquitectura<br/>Define la trama urbana y zonificación")
                        C("Diseño Vial y Movimiento de Tierra<br/>Diseña calles, perfiles y terrazas")
                        D("Diseño Eléctrico<br/>Define red de media tensión y alumbrado")
                        E("Diseño de Drenaje Pluvial<br/>Gestiona aguas de lluvia")
                        F("Diseño Hidrosanitario<br/>- Agua Potable y SCI<br/>- Aguas Negras (PTAR/STAR)")
                        G("Estudio de Impacto Ambiental (EIA / PGA)<br/>Evalúa y mitiga impactos en todas las áreas")
                    end

                    subgraph "Fase 3: Soporte e Integración Final"
                        I("Diseño Estructural<br/>Calcula y detalla obras civiles")
                        K("Presupuesto y Planos Finales<br/>Integra todos los diseños")
                    end

                    subgraph "Entidades de Supervisión y Aprobación"
                        L("COORDINACIÓN GENERAL (INVUR)")
                        M("PERMISOLOGÍA<br/>- INETER, ENACAL, MARENA, Alcaldías")
                    end
                    
                    class A,H,J estudios;
                    class B rector;
                    class C,D,E,F infraestructura;
                    class G ambiental;
                    class I,K soporte;
                    class L,M gestion;

                    A --> B; A --> C; A --> D; A --> E; A --> F; A --> G;
                    H --> B; H --> C; H --> E; H --> F; H --> I;
                    J --> E; J --> F;
                    B --> C; B --> D; B --> E; B --> F; B --> G; B --> K;
                    C <--> E; C <--> F; C --> I; C --> K;
                    D --> K;
                    E --> I; E --> K;
                    F --> I; F --> K;
                    G --> K;
                    I --> K;
                    L --> A; L --> H; L --> J; L --> B; L --> G; L --> K;
                    M <--> B; M <--> D; M <--> F; M <--> G;

                    click A call openModal("A")
                    click H call openModal("H")
                    click J call openModal("J")
                    click B call openModal("B")
                    click C call openModal("C")
                    click D call openModal("D")
                    click E call openModal("E")
                    click F call openModal("F")
                    click G call openModal("G")
                    click I call openModal("I")
                    click K call openModal("K")
                    click L call openModal("L")
                    click M call openModal("M")
            </div>
        </div>
    </div>

    <!-- Modal para mostrar información detallada -->
    <div id="infoModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 id="modalTitle" class="text-xl font-bold text-gray-800"></h2>
                <button id="closeModal" class="text-gray-500 hover:text-gray-800 text-2xl leading-none">&times;</button>
            </div>
            <div id="modalContent" class="p-6 overflow-y-auto">
                <p></p>
            </div>
        </div>
    </div>

    <script>
        // Datos con la información de cada nodo
        const nodeInfo = {
            A: { title: 'Topografía', text: 'Realizar el levantamiento planimétrico y altimétrico detallado del terreno, incluyendo estructuras existentes, accidentes geográficos y linderos. Es el lienzo base para todos los demás diseños.' },
            H: { title: 'Geología y Geotecnia', text: 'Investigar la existencia de fallas superficiales (con aval de INETER), caracterizar los estratos del suelo, determinar su capacidad portante, potencial de infiltración, y localizar bancos de materiales. Define las restricciones y oportunidades del subsuelo.' },
            J: { title: 'Estudios Hidrológicos e Hidrogeológicos', text: 'Calcular los caudales de escorrentía pluvial (considerando cambio climático) e investigar las fuentes de agua subterránea para el abastecimiento. Es clave para el manejo del agua en el proyecto.' },
            B: { title: 'Diseño Urbanístico y Arquitectura', text: 'Como diseño rector, organiza el espacio: define la lotificación, la trama vial, áreas verdes, equipamiento y zonas comunales, integrando el proyecto con el entorno urbano existente. Dirige el trabajo de las especialidades de infraestructura.' },
            C: { title: 'Diseño Vial y Movimiento de Tierra', text: 'Diseñar la geometría de calles y andenes (planimetría y altimetría), diseñar la estructura de pavimento y calcular el balance de corte y relleno para crear las terrazas de los lotes. Se coordina estrechamente con drenaje e hidrosanitario.' },
            D: { title: 'Diseño Eléctrico', text: 'Diseñar la red de distribución eléctrica de media tensión y el sistema de alumbrado público para toda la urbanización, siguiendo el trazado vial y urbanístico.' },
            E: { title: 'Diseño de Drenaje Pluvial', text: 'Diseñar el sistema para manejar las aguas de lluvia, incluyendo cauces, tuberías, cajas puente y tragantes, para evitar inundaciones y garantizar la seguridad. Depende de la hidrología y se coordina con el diseño vial.' },
            F: { title: 'Diseño Hidrosanitario', text: 'Diseñar la red de distribución de agua potable (incluyendo pozos, tanques y sistema contra incendios) y el sistema de recolección y tratamiento de aguas residuales (conexión a red, PTAR o sistemas individuales). Requiere aval de ENACAL.' },
            G: { title: 'Estudio de Impacto Ambiental (EIA / PGA)', text: 'Como componente transversal, evalúa los posibles impactos del proyecto en todas sus facetas (sociales, naturales, etc.) y propone medidas de mitigación para asegurar el cumplimiento de la normativa ambiental. Requiere resolución de MARENA.' },
            I: { title: 'Diseño Estructural', text: 'Realizar el cálculo y diseño detallado de todas las obras civiles que lo requieran: muros de contención, cimentaciones, tanques de agua, puentes, cajas puente, canales revestidos, etc. Da soporte a las demás ingenierías.' },
            K: { title: 'Presupuesto y Planos Finales', text: 'Integrar todos los diseños, especificaciones técnicas y memorias de cálculo en un paquete de planos constructivos final. Elaborar el presupuesto detallado del proyecto, incluyendo costos unitarios y volúmenes de obra.' },
            L: { title: 'Coordinación General (INVUR)', text: 'Supervisar el avance general del proyecto, revisar la calidad de los productos, asegurar la correcta interacción entre disciplinas y ser el enlace principal con la firma consultora.' },
            M: { title: 'Permisología', text: 'Gestionar y obtener todas las aprobaciones, avales y permisos necesarios de las instituciones reguladoras correspondientes (INETER, ENACAL, MARENA, Alcaldías) para garantizar la viabilidad legal y técnica del proyecto.' }
        };

        // Lógica para el Modal
        const modal = document.getElementById('infoModal');
        const modalContainer = modal.querySelector('div');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent').querySelector('p');
        const closeModalBtn = document.getElementById('closeModal');

        // Hacer la función openModal accesible globalmente para que Mermaid pueda llamarla
        window.openModal = (id) => {
            const info = nodeInfo[id];
            if (info) {
                modalTitle.textContent = info.title;
                modalContent.textContent = info.text;
                modal.classList.remove('hidden');
                modalContainer.classList.remove('modal-leave');
                modalContainer.classList.add('modal-enter');
            }
        };

        const closeModal = () => {
            modalContainer.classList.remove('modal-enter');
            modalContainer.classList.add('modal-leave');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); // Coincide con la duración de la animación
        };

        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Inicializa Mermaid
        mermaid.initialize({
            startOnLoad: true,
            flowchart: {
                ranksep: 70 
            }
        });
    </script>
</body>
</html>
